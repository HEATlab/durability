<!DOCTYPE html>
<meta charset="utf-8">
<style>

line {
  stroke-width: 3px;
}


circle {
  fill: teal;
  stroke: #333;
  stroke-width: 1.5px;
}

text {
  font: 15px sans-serif;
  pointer-events: none;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var w = 800,
    h = 400,
    xPadding = 50,
    yPadding = 60,
    r = 20;

d3.json("json/two_agent_T.json", function(data) {

var numAgents = data.numAgents;

var nodes = data.nodes;

var constraints = data.constraints;

var xScale = d3.scale.linear()
                     .domain([0, d3.max(nodes, function(d)
                     { return d.local_id; })])
                     .range([xPadding,w-xPadding]);

var yScale = d3.scale.linear()
                     .domain([0, d3.max(nodes, function(d)
                     { return d.owner_id;} )])
                     .range([yPadding, h-yPadding]);

var findx1 = function(d) { return xScale(nodes[(d.first_node)-1].local_id); };

var findy1 = function(d) { return yScale(nodes[(d.first_node)-1].owner_id); };

var findx2 = function(d) { return xScale(nodes[(d.second_node)-1].local_id); };

var findy2 = function(d) { return yScale(nodes[(d.second_node)-1].owner_id); };


var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h);

var lines = svg.selectAll("line")
               .data(constraints)
               .enter()
               .append("line");

lines.attr("x1", function(d) { return findx1(d);})
     .attr("y1", function(d) { return findy1(d);})
     .attr("x2", function(d) { return findx2(d);})
     .attr("y2", function(d) { return findy2(d);});

lines.attr("stroke", function(d) {
                    if (nodes[d.first_node-1].start == true || d.second_node-d.first_node != 1) {
                      return "black";
                    } else {
                      return "orange";
                    }});

lines.attr("stroke-dasharray", function(d) {
                    if (nodes[d.first_node-1].owner_id != nodes[d.second_node-1].owner_id) {
                      return "10 5";
                    } else {
                      return "1 0";
                    }});

svg.append("defs").append("marker")
   .attr("id", "arrowhead")
   .attr("refX", r/2)
   .attr("refY", 2)
   .attr("markerWidth", 6)
   .attr("markerHeight", 6)
   .attr("orient", "auto")
   .append("path")
       .attr("d", "M 0,0 V 4 L6,2 z");

lines.attr("marker-end", "url(#arrowhead)");

var circles = svg.selectAll("circle")
                 .data(nodes)
                 .enter()
                 .append("circle");

circles.attr("cx", function(d) { return xScale(d.local_id); })
       .attr("cy", function(d) { return yScale(d.owner_id);})
       .attr("r", r);

var nodeNums = svg.selectAll("textNodeNums")
                  .data(nodes)
                  .enter()
                  .append("text")
                  .text(function(d){return d.node_id;});

var nodeTimes = svg.selectAll("textNodeTimes")
                   .data(nodes)
                   .enter()
                   .append("text")
                   .text(function(d) {
                     return "[" + d.min_domain + "," + d.max_domain + "]";
                   });

var edgeTimes = svg.selectAll("textEdgeTimes")
                   .data(constraints)
                   .enter()
                   .append("text")
                   .text(function(d) {
                     if (d.max_duration == "inf") {
                     return "["+d.min_duration + ",âˆž]";
                   } else {
                     return "[" + d.min_duration + "," + d.max_duration + "]";
                   }});

nodeNums.attr("x", function(d) { return xScale(d.local_id); })
        .attr("y", function(d) { return yScale(d.owner_id) + 5;})
        .attr("text-anchor", "middle");

nodeTimes.attr("x", function(d) { return xScale(d.local_id); })
         .attr("y", function(d) { return yScale(d.owner_id) - r - 5})
         .attr("text-anchor", "middle");

edgeTimes.attr("x", function(d) {
                    if (nodes[d.first_node-1].owner_id == nodes[d.second_node-1].owner_id) {
                      return (findx2(d) - findx1(d))/2 + findx1(d);
                    } else {
                      return (findx2(d) - findx1(d))/2 + findx1(d) + 30;
                    }})
        .attr("y", function(d) {
                    if (nodes[d.first_node-1].owner_id == nodes[d.second_node-1].owner_id) {
                      return (findy2(d) - findy1(d))/2 + findy1(d) - 15;
                    } else {
                      return (findy2(d) - findy1(d))/2 + findy1(d);
                    }})
        .attr("text-anchor", "middle");

      });


</script>
